<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:pro="http://www.liquibase.org/xml/ns/pro"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd
						http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.1.xsd">

	<changeSet id="init_payment_event_table" author="auth">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="payment_event" />
			</not>
		</preConditions>
		<sql splitStatements="true" stripComments="true">
			CREATE TABLE IF NOT EXISTS payment_event (
			payment_event_id character varying(64) NOT NULL,
			payment_header_id character
			varying(40),
			submitted_date timestamp,
			txn_type varchar(25),
			txn_state
			varchar(64),
			amount numeric,
			payment_reference varchar(25),
			merchant_account_name varchar(40),
			merchant_reference
			varchar(100),
			error_message varchar(255),
			error_code varchar(10),
			event_details jsonb,
			last_modified_date timestamp,
			last_modified_by
			varchar(255),
			gateway_indicator varchar(40),
			CONSTRAINT
			payment_event_pkey PRIMARY KEY (payment_event_id),
			CONSTRAINT payment_event_fkey FOREIGN KEY (payment_header_id)
			REFERENCES public.payment_header (payment_header_id) MATCH SIMPLE
			ON UPDATE NO ACTION
			ON DELETE NO ACTION
			);
		</sql>
	</changeSet>
	<changeSet id="update_payment_reference" author="auth">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="payment_event" />
		</preConditions>
		<sql splitStatements="true" stripComments="true">
			alter table payment_event 
			alter column payment_reference TYPE varchar(64);
		</sql>
	</changeSet>
</databaseChangeLog>